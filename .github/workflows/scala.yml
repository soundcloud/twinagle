name: Scala CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: Run tests
      run: sbt +test scripted
    - name: Create Keys
      if: github.repository.fork == false
      env:
        PGP_PASSWORD: ${{ secrets.PGP_PASSWORD }}
        PGP_PRIVATE_KEY: ${{ secrets.PGP_PRIVATE_KEY }}
      run: 'echo "$PGP_PRIVATE_KEY" > ./secring.asc && echo "$PGP_PASSWORD" | gpg --passphrase-fd 0 --batch --yes --import ./secring.asc'
    - name: Release
      if: github.repository.fork == false
      env:
        CI: "true"
        PGP_PASSWORD: ${{ secrets.PGP_PASSWORD }}
        SONATYPE_USER: soundcloud
        SONATYPE_PASSWORD: ${{ secrets.SONATYPE_PASSWORD }}
      run: sbt +releaseEarly sonatypeBundleRelease
